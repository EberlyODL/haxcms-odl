<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../haxcms-elements/haxcms-theme-behavior.html">
<link rel="import" href="../schema-behaviors/schema-behaviors.html">
<link rel="import" href="../simple-colors/simple-colors.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../map-menu/map-menu.html">

<!--
`odl-haxtheme`
A theme intended as the starting point to fork from and build new themes for HAXCMS
which allows you to build things that just work using JSON Outline Schema as it's "backend"
and then IF hax is around it'll show up :)

@demo demo/index.html

-->
<dom-module id="odl-haxtheme">
  <template>
    <style is="custom-style" include="simple-colors">

    </style>
    <h1 style="margin:0;">[[manifest.title]]</h1>
    <map-menu id="menu"></map-menu>
    <div class="manifest">
    <h2>title: [[manifest.title]]</h2>
    <div>description: [[manifest.description]]</div>
    <div>icon: <iron-icon icon="[[manifest.metadata.icon]]"></iron-icon></div>
    <div>image: <img src$="[[manifest.metadata.image]]" height="200px" width="200px" /></div>
    </div>
    <div class="activeitem">
    <paper-button id="unset">Unset activeItem</paper-button>
    <h2>ACTIVE ITEM</h2>
    <div>[[activeItem.title]]</div>
    <div id="contentcontainer">
      <div id="slot">
        <slot></slot>
      </div>
    </div>
    </div>
  </template>
  <script>
    Polymer({
      is: 'odl-haxtheme',
      behaviors: [
        SchemaBehaviors.Schema,
        window.simpleColorsBehaviors,
        HAXCMSBehaviors.Theme,
      ],
      properties: {
        // The behavior gives you editMode, activeItem and manifest
        // You can add whatever else you need here
      },
      listeners: {
        'unset.tap': '_unsetTapped',
        'menu.selected': '__menuSelectedItemChanged'
      },
      observers: [
        '__manifestNavigationChanged(manifest.items)'
      ],
      /**
       * Ready life cycle
       */
      ready: function () {
        // required so that HAX is injected when available
        this.setupHAXTheme();
      },
      /**
       * Detatched life cycle
       */
      detached: function () {
        // this helps with cleaning things up if the theme is changed
        this.setupHAXTheme(false);
      },
      /**
       * Settings activeItem to nothing will ensure that state goes back to nothing active
       * and then other options appear
       */
      _unsetTapped: function (e) {
        this.fire('json-outline-schema-active-item-changed', {});
      },
      /**
       * Listen for the user to select an item on the menu and change the page
       */
      __menuSelectedItemChanged: function (e) {
        const manifestJOS = this.manifest.items
        const activeItem = manifestJOS.find(item => {
          if (item.id === e.detail) {
            return true
          }
          return false
        })
        this.fire('json-outline-schema-active-item-changed', activeItem);
      },
      /**
       * When the navigation in the manifest changes then rebuild the menu
       */
      __manifestNavigationChanged: function (items) {
        if (typeof items !== 'undefined' && items.length) {
          this.$.menu.setData(items)
        }
      },
    });
  </script>
</dom-module>
