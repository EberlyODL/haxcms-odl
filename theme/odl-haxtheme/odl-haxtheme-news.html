<link rel="import" href="page-banner.html">
<link rel="import" href="../iron-image/iron-image.html">
<dom-module id="odl-haxtheme-news">
  <template>
    <style>
      :host {
        display: block;
        --theme-color-1: #363533;
        --theme-color-2: #e2801e;
        --theme-color-4: #fff;
      }


      h2 {
        margin: 0;
        font-weight: normal;
        font-size: 26px;
      }

      .news_container {
        display: flex;
        width: 80%;
        margin-left: auto;
        margin-right: auto;
      }

      .news_page_feed {
        width: 75%;
      }

      #card_wrap {
        background-color: var(--font-color);
        margin: 25px;
        padding: 15px;
        box-shadow: 0 1px 2px #dcdcdc;
      }

      #card_image {
        margin-right: 15px;
        float: left;
      }

      #card_image iron-image {
        height: 200px;
        width: 175px;
      }

      #card_heading h2 {
        color: var(--theme-color-2);
        margin: 11px 0px 5px;
        font-weight: bold;
      }

      #card_heading a {
        text-decoration: none;
      }

      #post_date {
        margin-bottom: 5px;
      }

      .sidebar_wrap {
        width: 25%;
        margin-top: 15px;
      }

      #card_description {
        margin-bottom: 10px;
        font-weight: 300;
      }

      #card_footer iron-image {
        height: 50px;
        width: 50px;
        border-radius: 50%;
        margin-right: 5px;
      }

      #card_footer {
        display: flex;
        align-items: center;
        padding-right: 15px;
      }
    </style>
    <page-banner image="../odl/assets/theme-images/page-banners/news_banner.png"
      text="News" alt="Gateway to the Sciences"></page-banner>
    <div id="news_wrap">
      <div class="news_container">
        <div class="news_page_feed">
          <template is="dom-repeat" items="[[_items]]">
            <div id="card_wrap">
              <div id="card_image">
                <iron-image  sizing="cover"
                  src="[[item.metadata.image]]"></iron-image>
              </div>
              <div id="card_heading">
                <a href$="[[_getLink(item.id)]]">
                  <h2>[[item.title]]</h2>
                </a>
              </div>
              <div id="post_date">
                <span>[[_formatDate(item.metadata.created)]]</span>
              </div>
              <div id="card_description">
                <span>[[item.description]]</span>
              </div>
              <div id="card_footer">
                <iron-image id="author_image"
                  sizing="cover" src="[[item.metadata.authorImage]]"></iron-image>
                <div id="author_name">[[item.metadata.author]]</div>
              </div>
            </div>
          </template>
        </div>
        <div class="sidebar_wrap">
          <div id="twitter_feed">
              <a class="twitter-timeline" data-height="600" href="https://twitter.com/Eberly_ODL?ref_src=twsrc%5Etfw">Tweets by Eberly_ODL</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </div>
        </div>

      </div>
    </div>

    <!-- The slot area is for content that will be edited by HAX
    <slot></slot> -->
  </template>
  <script>
    Polymer({
      is: 'odl-haxtheme-news',
      properties: {
        /**
        * Type of data to select from site.json
        */
        type: {
          type: String,
          value: 'news',
          reflectToAttribute: true,
        },
        /**
        * Items from sites.json
        */
        _items: {
          type: Array,
          value: [],
        },
      },

      _getLink: function (id) {
        return `?page=item-${id}`
      },  

      _formatDate: function (unixTimecode) {
        const date = new Date(unixTimecode * 1000)
        const dateFormatted = date.toLocaleDateString("en-US", {
          year: 'numeric', month: 'long', day: 'numeric'
        })

        return dateFormatted;
      },   

      ready: async function () {
        const manifest = await fetch('/_sites/odl/site.json').then(res => res.json())
        const pages = manifest.items
        const pagesFiltered = pages.filter(item => {
          if (typeof item.metadata !== 'undefined') {
            if (typeof item.metadata.type !== 'undefined') {
              if (item.metadata.type === 'news') {
                return true;
              }
            }
          }
          return false
        })

        // const pagesTrimmed = pagesFiltered.slice(2);
        // this.set("_items", pagesTrimmed);

        this.set("_items", pagesFiltered);

        // To do - Will need to sort by date created.
      }
    });
  </script>
</dom-module>